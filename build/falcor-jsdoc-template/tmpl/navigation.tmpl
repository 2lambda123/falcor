<?js
  (function (self) {
    var classDocs = self.find({kind: 'class'})
    var keys = _.keys(classDocs[1])
    var getMethods = function (classDoc) {
      var result = self.find({kind: 'function', memberof: classDoc.longname})
      return result || [];
    }
    var typeDocs = self.find({kind: 'typedef'})
    // So far I haven't encountered any pages with more than one doc in the doclist, but
    // based on the original template I'm guessing it's possible
    var currentDoc = _.first(docs);
?>

<?js if (docs && docs.length > 0) { ?>
<!--
  In case someone comes along later and sees the active item on the
  toc acting weirdly, hopefully they'll see this comment. This page, unlike
  any seen during development, has multiple 'docs' passed to container.tmpl.
  To debug it and enhance the page as needed, I would suggest looking there first.
-->
<?js } ?>

<!-- Generate the table of contents -->
<nav class="table-of-contents api-doc-toc">
  <ul class="nav">
    <li>
      <span class="toc-api-section-title">Classes</span>
      <ul class="toc-api-classes">
        <?js _.each(classDocs, function (classDoc) { ?>
          <li class="toc-api-class <?js= currentDoc.longname === classDoc.longname ? 'current-page' : '' ?>">
            <?js= self.linkto(classDoc.longname, classDoc.name) ?>
            <?js var methodDocs = getMethods(classDoc); ?>
            <?js if (methodDocs.length) { ?>
              <ul class="toc-api-methods">
              <?js _.each(methodDocs, function (methodDoc) { ?>
                <li class="toc-api-method">
                  <?js= self.linkto(methodDoc.longname, methodDoc.name) ?>
                </li>
              <?js }) ?> 
              </ul>
            <?js } ?>
          </li>
        <?js }) ?>
      </ul>
    </li>
    <li>
      <?js= self.linkto('global', 'Global Types') ?>
      <ul class="api-toc-types">
        <?js _.each(typeDocs, function (typeDoc) { ?>
          <li>
            <?js= self.linkto(typeDoc.longname, typeDoc.name) ?>
          </li>
        <?js }) ?>
      </ul>
    </li>
  </ul>
</nav>

<?js }(this)) ?>
